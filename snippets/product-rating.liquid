{% comment %} {%- assign has_real_rating = product.metafields.reviews.rating.value != blank -%} {% endcomment %}
{%- if product.metafields.reviews.rating.value != blank -%}
  {%- assign rating_decimal = 0 -%}
  {%- assign decimal = product.metafields.reviews.rating.value.rating | modulo: 1 -%}

  {%- if decimal >= 0.3 and decimal <= 0.7 -%}
    {%- assign rating_decimal = 0.5 -%}
  {%- elsif decimal > 0.7 -%}
    {%- assign rating_decimal = 1 -%}
  {%- endif -%}

  <div class="rating">
    <div
      class="rating__stars"
      role="img"
      aria-label="{{ 'general.accessibility.star_reviews_info' | t: rating_value: product.metafields.reviews.rating.value, rating_max: product.metafields.reviews.rating.value.scale_max }}">
      {%- assign rating_as_float = product.metafields.reviews.rating.value.rating | times: 1.0 -%}
      {%- for i in (product.metafields.reviews.rating.value.scale_min..product.metafields.reviews.rating.value.scale_max) -%}
        {%- if rating_as_float >= i -%}
          {%- render 'icon' with 'rating-star-full'
            , class: 'rating__star rating__star--full' -%}
        {%- else -%}
          {%- if rating_decimal == 0.5 -%}
            {%- render 'icon' with 'rating-star-half'
              , class: 'rating__star rating__star--half' -%}
          {%- elsif rating_decimal == 1 -%}
            {%- render 'icon' with 'rating-star-full'
              , class: 'rating__star rating__star--full' -%}
          {%- else -%}
            {%- render 'icon' with 'rating-star'
              , class: 'rating__star rating__star--empty' -%}
          {%- endif -%}
          {%- assign rating_decimal = false -%}
        {%- endif -%}
      {%- endfor -%}
    </div>
    <span class="rating__caption">{{ 'product.general.reviews_count' | t: count: product.metafields.reviews.rating_count.value }}</span>
  </div>
{%- else -%}
  {%- comment %} Mock/fake rating system for products without real reviews {%- endcomment -%}
  {%- assign mock_seed = product.id | default: 12345 | modulo: 6 -%}
  {%- assign mock_rating = 4.0 | plus: mock_seed | divided_by: 10.0 -%}
  {%- assign mock_rating = mock_rating | round: 1 -%}
  {%- assign mock_seed_reviews = product.id | default: 12345 | modulo: 40 -%}
  {%- assign mock_reviews = 10 | plus: mock_seed_reviews -%}
  {%- assign rating_int = mock_rating | floor -%}
  {%- assign rating_decimal = mock_rating | minus: rating_int -%}
  {%- assign half_star_index = rating_int | plus: 1 -%}
  <div class="rating">
    <div
      class="rating__stars"
      role="img"
      aria-label="{{ 'general.accessibility.star_reviews_info' | t: rating_value: mock_rating, rating_max: 5 }}">
      {%- for i in (1..5) -%}
        {%- if i <= rating_int -%}
          {%- render 'icon' with 'rating-star-full'
            , class: 'rating__star rating__star--full' -%}
        {%- elsif i == half_star_index and rating_decimal >= 0.5 -%}
          {%- render 'icon' with 'rating-star-half'
            , class: 'rating__star rating__star--half' -%}
        {%- else -%}
          {%- render 'icon' with 'rating-star'
            , class: 'rating__star rating__star--empty' -%}
        {%- endif -%}
      {%- endfor -%}
    </div>
    <span class="rating__caption">{{ 'product.general.reviews_count' | t: count: mock_reviews }}</span>
  </div>
{%- endif -%}